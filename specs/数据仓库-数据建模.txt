
第8章 大数据领域建模综述 130
8.1 为什么需要数据建模 130
8.2 关系数据库系统和数据仓库 131
8.3 从OLTP和OLAP系统的区别看模型方法论的选择 132
8.4 典型的数据仓库建模方法论 132
8.4.1 ER模型 132
8.4.2 维度模型 133
8.4.3 Data Vault模型 134
8.4.4 Anchor模型 135
8.5 阿里巴巴数据模型实践综述 136


第9章 阿里巴巴数据整合及管理体系 138
9.1 概述 138
9.1.1 定位及价值 139
9.1.2 体系架构 139
9.2 规范定义 140
9.2.1 名词术语 141
9.2.2 指标体系 141
9.3 模型设计 148
9.3.1 指导理论 148
9.3.2 模型层次 148
9.3.3 基本原则 150
9.4 模型实施 152
9.4.1 业界常用的模型实施过程 152
9.4.2 OneData实施过程 154


数据仓库中的分析查询

只是基于一小部分字段进行的，类似于列存储结构，可以大大减少数据
，从而对查询性能影响较小

一些有数据表裁剪（ Table Elimination)特性的数据库如Maria DB 的出现，
还会大量减少join 操作

当时MPP 架构体系的Greenplum

了以Kimball 的维度建模
为核心理念的模型方法论，同时对其进行了一定的升级和扩展，构建了
阿里巴巴集团的公共层模型数据架构体系。

着力解决数据存储和计算的共享问题

一致性的指标定义体系、模型设计方法体系以及配套工具。

----------------------------------

从业务架构设计到模型
设计，从数据研发到数据服务，做到数据可管理、可追溯、可规避重复
建设

建设统一的、规范化的数据接人层（ ODS ）和数据中间层（ DWD
和DWS ），通过数据服务和数据产品，完成服务于阿里巴巴的大数据系
统建设，即数据公共层建设。提供标准化的（ Standard ）、共享的（ Shared ）、
数据服务（ Service ）能力，


数据接人层（ ODS ）
数据中间层（ DWD和DWS ），


提供标准化的（ Standard ）、共享的（ Shared ）、
数据服务（ Service ）能力

降低数据互通成本

一套数据规范命名体系，规范定义将会被用
在模型设计中
数据域、业务过程、维度、度量／ 原子指标、修饰类型、修饰词、时间周期、派生指标


划分和定义
数据域、业务过程、维度、度量／ 原子指标、修饰类型、修饰词、时间
周期、派生指标。



数据域


指面向业务分析，将业务过程或者维度进行抽象的集合。
其中 业务过程可以概f肯为一个个不可拆分的行为事件，
在业务过程之下，可以定义指标；
维度是指度E数据域的环境，如买家下单事件，买家是维度。
为保障整个体系的生命力， 数据域是需要
抽象提炼，并且长期维护和更新的， 但不轻易变动。

在划分数据域时， 既能涵盖当前所有的业务需求，
又能在新业务进入时无影响地被包含进已有的数据域中和扩展
新的数据域


业务过程
指企业的业务活动事件，如下单、支付、退款都是业务过程。请注意，业务过程
是一个不可拆分的行为事件，通俗地讲，业务过程就是企业活动中的事件

时间周期用来明确数据统计的时间范用或者时间点，如最近30 天、自然周、截至当日等

修饰类型
是对修饰词的一种抽象划分。修饰类型从属于某个业务域，
如日志域的访问终端类型涵盖无线端、PC 端等修饰词

修饰词
指除了统计维度以外指标的业务场景限定抽象。
修饰词隶属于一种修饰类型，如在日志域的访问终端类型下， 有修饰词PC 端、无线端等

度量（原子指标）
原原子指标和度自含义相同，
基于某一业务事件件行为下的度量，是业务定义中不可子指标再拆分的指标，具有明确业务含义的名词，如支付金额

维度
度盟的环境，用来反映业务的一类属性， 这类属性的集合构成一个维度，
维度也可以称为实体对象。
维度属于一个数据域，如地理维度（其中包挤罔家、地区、省以及城市等级别的内容）、时间维度（其中包括年、季、月、周、日等级别的内容）

维度属性
隶属于一个维度， 如地理维度里面的国家名称、同家ID 、省份名称等都属于维度属性

派生指标=一个原子指标＋多个修饰词（可选）＋时间周期。
可以理解为对原子指派生指标标业务统计范围的圈定。

如原子指标： 支付金额，最近l 天海外买家支付金额则为

派生指标
（最近l 天为时间周期， 海外为修饰词， 买家作为维度，而不作为修饰词）


指标体系
派生指标由原子指标、时间周期修饰词、若干其他修饰词组合得
到

事务型指标和存量型指标（见下文定义）只会唯一定位
到一个业务过程，如果遇到同时有两个行为发生、需要多个修饰词、生
成一个派生指标的情况，则选择时间靠后的行为创建原子指标，选择时
间靠前的行为创建修饰词。


原子指标有确定的英文字段名、数据类型和算法说明：
派生指标要继承原子指标的英文名、数据类型和算法要求。
--------------------------
命名约定
· 命名所用术语。指标命名，尽量使用英文简写，其次是英文， 当
指标英文名太长时，可考虑用汉语拼音首字母命名。如中国质造，
用zgzc 。在OneData 工具中维护着常用的名词术语，以用来进行
命名。
·业务过程。英文名：用英文或英文的缩写或者中文拼音简写$中
文名：具体的业务过程中文即可，如图9.4 所示。


原子指标。英文名：动作＋度量：中文名：动作＋度量。原子指标
必须挂靠在某个业务过程下，如


修饰词。只有时间周期才会有英文名，且长度为2 位，加上“ 一”
为3 位，例如一ld 。其他修饰词无英文名。

中文名英文名中文名英文名
最近l 天Id 自然月cm
最近3 天3d 自然季度cq
最近7 天lw 截至当日td
最近14 天2w 年初截至当日sd
最近30 天Im 零点截至当前“
最近60 天2m 财年fy
最近90 天3m 最近i 小时lh
最近180 天6m 准实时ts
180 天以前bh 未来7 天flw
自然周CW 未来4 周f4w


派生指标。英文名： 原子指标英文名＋时间周期修饰词（ 3 位，
例如＿ Id) ＋序号（ 4 位，例如一001 ）；中文名：时间周期修饰词
＋［其他修饰词］＋原子指标


序号是根据原子指标＋派生
指标自增的。

原子指标、修饰词、派生指标的算法说明必须让各种使用人员看得
明白，包括：
· 算法概述一一算法对应的用户容易理解的阐述。
． 举例一一通过具体例子帮助理解指标算法。
? SQL 算法说明一一对于派生指标给出SQL 的写法或者伪代码。
2

事务型指标、存量型指标和复合型指标。
按照其特性不同，有些必须新建原子指标，有些可以在其他类型原子指
标的基础上增加修饰词形成派生指标。

事务型指标： 是指对业务活动进行衡量的指标。例如新发商品数、
重发商品数、新增注册会员数、订单支付金额，这类指标需维护
原子指标及修饰词，在此基础上创建派生指标。
· 存量型指标：是指对实体对象（如商品、会员）某些状态的统计。
例如商品总数、注册会员总数，这类指标需维护原子指标及修饰
词，在此基础上创建派生指标，对应的时间周期一般为“历史截
至当前某个时间”。
· 复合型指标：是在事务型指标和存量型指标的基础上复合而成
的。例如浏览UV－下单买家数转化率， 有些需要创建新原子指标，
有些则可以在事务型或存量型原子指标的基础上增加修饰词得
到派生指标

复合型指标：是在事务型指标和存量型指标的基础上复合而成
的。例如浏览UV－下单买家数转化率， 有些需要创建新原子指标，
有些则可以在事务型或存量型原子指标的基础上增加修饰词得
到派生指标。

比率型： 创建原子指标，如C TR 、浏览UV－ 下单买家数转化率、
满意率等。例如，“最近1 天店铺首页C TR ”，原子指标为“ CTR ”，
时间周期为“最近l 天”，修饰类型为“页面类型”，修饰词为“店
铺首页”。

比例型： 创建原子指标，如百分比、占比。例如“ 最近1 天无线
支付金额占比”，原子指标为“支付金额占比”，修饰类型为“终
端类型”，修饰词为“无线”。

变化量型：不创建原子指标，增加修饰词，在此基础上创建派生
指标。例如，“最近l 天订单支付金额上l 天变化量”，原子指标
为“订单支付金额”，时间周期为“最近1 天”，修饰类型为“统
计方法”，修饰词为“上l 天变化量”。

变化率型：创建原子指标。例如，“最近7 天海外买家支付金额
上7 天变化率”，原子指标为“支付金额变化率”，修饰类型为“ 买
家地域”，修饰词为“海外买家”。
·统计型（均值、分位数等）：不创建原子指标，增加修饰词，在
此基础上创建派生指标；在修饰类型“统计方法”下增加修饰词，
如人均、日均、行业平均、商品平均、90 分位数、70 分位数等。
例如，“自然月日均UV ”，原子指标为“ UV ”，修饰类型为“统
计方法”，修饰词为“日均”。
· 排名型： 创建原子指标， 一般为top_xxx_xxx ，有时会同时选择
rank 和top_ xxx xxx 组合使用。创建派生指标时选择对应的修饰
词如下：
〉统计方法（如降序、升序）。
》排名名次（如TOP IO ）。
》排名范围（如行业、省份、一级来源等）。
》根据什么排序（如搜索次数、PV ）。
示例如图9 . 7 所示。
· 对象集合型： 主要是指数据产品和应用需要展现数据时，将一些
对象以k-v 对的方式存储在一个字段中，方便前端展现。比如趋
势图、TOP 排名对象等。其定义方式是，创建原子指标， 一般为
xxx 串：创建派生指标时选择对应的修饰词如下：

------------------------------------------------------

派生指标的种类
派生指标可以分为三类： 事务型指标、存量型指标和复合型指标。
按照其特性不同，有些必须新建原子指标，有些可以在其他类型原子指
标的基础上增加修饰词形成派生指标。
· 事务型指标： 是指对业务活动进行衡量的指标。例如新发商品数、
重发商品数、新增注册会员数、订单支付金额，这类指标需维护
原子指标及修饰词，在此基础上创建派生指标。
· 存量型指标：是指对实体对象（如商品、会员）某些状态的统计。
例如商品总数、注册会员总数，这类指标需维护原子指标及修饰
词，在此基础上创建派生指标，对应的时间周期一般为“历史截
至当前某个时间”。
· 复合型指标：是在事务型指标和存量型指标的基础上复合而成
的。例如浏览UV－下单买家数转化率， 有些需要创建新原子指标，
有些则可以在事务型或存量型原子指标的基础上增加修饰词得
到派生指标。
(2 ）复合型指标的规则
· 比率型： 创建原子指标，如C TR 、浏览UV－ 下单买家数转化率、
满意率等。例如，“最近1 天店铺首页C TR ”，原子指标为“ CTR ”，
时间周期为“最近l 天”，修饰类型为“页面类型”，修饰词为“店
铺首页”。
· 比例型： 创建原子指标，如百分比、占比。例如“ 最近1 天无线
支付金额占比”，原子指标为“支付金额占比”，修饰类型为“终
端类型”，修饰词为“无线”。
·变化量型：不创建原子指标，增加修饰词，在此基础上创建派生
指标。例如，“最近l 天订单支付金额上l 天变化量”，原子指标
为“订单支付金额”，时间周期为“最近1 天”，修饰类型为“统
计方法”，修饰词为“上l 天变化量”。
·变化率型：创建原子指标。例如，“最近7 天海外买家支付金额
上7 天变化率”，原子指标为“支付金额变化率”，修饰类型为“ 买
家地域”，修饰词为“海外买家”。
·统计型（均值、分位数等）：不创建原子指标，增加修饰词，在
此基础上创建派生指标；在修饰类型“统计方法”下增加修饰词，
如人均、日均、行业平均、商品平均、90 分位数、70 分位数等。
例如，“自然月日均UV ”，原子指标为“ UV ”，修饰类型为“统
计方法”，修饰词为“日均”。
· 排名型： 创建原子指标， 一般为top_xxx_xxx ，有时会同时选择
rank 和top_ xxx xxx 组合使用。创建派生指标时选择对应的修饰
词如下：
〉统计方法（如降序、升序）。
》排名名次（如TOP IO ）。
》排名范围（如行业、省份、一级来源等）。
》根据什么排序（如搜索次数、PV ）。
示例如图9 . 7 所示。
· 对象集合型： 主要是指数据产品和应用需要展现数据时，将一些
对象以k-v 对的方式存储在一个字段中，方便前端展现。比如趋
势图、TOP 排名对象等。其定义方式是，创建原子指标， 一般为
xxx 串：创建派生指标时选择对应的修饰词如下：
Ill.. 146
第9 章间里巴巴数据整合及管理体系丁一－
〉统计方法（如降序、升序）。
》排名名次（如TOPIO ） 。
〉排名范围（如行业、区域）。

其他规则
( I ）上下层级派生指标同时存在时
如最近l 天支付金额和最近l 天PC 端支付金额，建议使用前者，
把PC 端作为维度属性存放在物理表中体现。
147 ...11111
一寸大数据之路一－阿里巴巴大数据实践
(2 ）父子关系原子指标存在时
当父子关系原子指标存在时，派生指标使用子原子指标创建派生指
标。如PV 、IPV （商品详情页PV ），当统计商品详情页PV 时，优先选
择子原子指标。

---------------
指导理论

操作数据层（ ODS ）、
公共维度模型层（ C DM ）和应用数据层（ A DS ）， 其中公共维度模型层
包括明细数据层（ DWD ）和汇总数据层（ DWS ）。模型层次关系如图
9.9 所示。
操作数据层（ ODS ）：把操作系统数据几乎无处理地存放在数据仓
库系统中。
· 同步：结构化数据增量或全量同步到MaxCompute 。
· 结构化：非结构化（日志）结构化处理并存储至lj MaxCompt闹。
． 累积历史、清洗：根据数据业务需求及稽核和审计要求保存历史
数据、清洗数据。


公共维度模型层（ CDM ）：存放明细事实数据、维表数据及公共指
标汇总数据， 其中明细事实数据、维表数据一般根据ODS 层数据加工
生成：公共指标汇总数据一般根据维表数据和明细事实数据加工生成。
CDM 层又细分为DWD 层和DWS 层，分别是明细数据层和汇总数

据层，采用维度模型方法作为理论基础， 更多地采用一些维度退化手法，
将维度退化至事实表中，减少事实表和维表的关联，提高明细数据表的
易用性：

同时在汇总数据层， 加强指标的维度退化， 采取更多的宽表化手段构建公共指标数据层，
提升公共指标的复用性，减少重复加工。其

主要功能如下。
·组合相关和相似数据：采用明细宽表，复用关联计算，减少数据
扫描。
·公共指标统一加工：基于OneData 体系构建命名规范、口径一致
和算法统一的统计指标，为上层数据产品、应用和服务提供公共
指标z 建立逻辑汇总宽表。
． 建立一致性维度：建立一致的数据分析维表，降低数据计算口径、
算法不统一的风险。



应用数据层（ ADS ）：存放数据产品个性化的统计指标数据，根据
CD M 层与ODS 层加工生成。

·个性化指标加工：不公用性、复杂性（指数型、比值型、排名型
指标）。
．基于应用的数据组装： 大宽表集市、横表转纵表、趋势指标串。
阿里巴巴通过构建全域的公共层数据，极大地控制了数据规模的增长趋势，
同时在整体的数据研发效率、成本节约、性能改进方面都有不错的效果。

数据调用服务优先使用公共维度模型层（ CDM ）数据，
当公共层没有数据时，需评估是否需要创建公共层数据，当不需要建设公用的公
共层时，方可直接使用操作数据层（ ODS ）数据。

应用数据层（ ADS)
作为产品特有的个性化数据一般不对外提供数据服务，
但是ADS 作为被服务方也需要遵守这个约定。


--------------

基本原则

高内聚 低耦合

将业务相近或者相关、粒度相同的数据设计为一个
逻辑或者物理模型：将高概率同时访问的数据放一起，将低概率同时访
问的数据分开存储。


核心模型与扩展模型分离

核心模型包括的宇段支持常用的核心业务，
扩展模型包括的字段支持个性化或少量应用


公共处理逻辑下沉及单一

越是底层公用的处理逻辑越应该在数据调度依赖的底层进行封装
与实现

成本与性能平衡
适当的数据冗余可换取查询和刷新性能

数据可回滚
处理逻辑不变，在不同时间多次运行数据结果确定不变。

一致性
具有相同含义的字段在不同表中的命名必须相同，必须使用规范定
义中的名称。


命名清晰、可理解
表命名需清晰、一致，表名需易于消费者理解和使用。

-------------
模型实施过程

Kimball 模型实施过程

第一个阶段是高层设计时期，

定义业务过程维度模型的范围，提供每种星形模式的技术和功能描述；、

直接产出目标是创建高层维度模型图，它是对
业务过程中的维表和事实表的图形描述。确定维表创建初始属性列表，
为每个事实表创建提议度量。

第二个阶段是详细模型设计时期，对每个星形模型添加属性和度量信
息；
为高层模型填补缺失的信息，解决设计问
题，并不断测试模型能否满足业务需求，确保模型的完备性。
确定每个
维表的属性和每个事实表的度量，并确定信息来源的位置、定义，确定
属性和度量如何填人模型的初步业务规则

第三个阶段是进行模型的审查、再设计和验证等工作，

召集相关人员进行模型的审查和验证，根据审查结果对
详细维度进行再设计

第四个阶段是产生详细设计文档，提交ETL 设计和开发，完成物理模型的设计和开发。。


Inmon 模型实施过程


Inmon 将模型划分为三个层次，分别是
ERD (Entity Relationship
Diagram ，实体关系图）层、
该层描述了公司业务中的实体或主
题域以及它们之间的关系

DIS ( Data Item Set ， 数据项集）层
描述了数据模型中的关键字、属性以及细节数据之间的关系

物理层（ Physical Model ，物理模型）。
描述了数据模型的物理特性

Inmon 对于构建数据仓库模型建议采用螺旋式开发方法，采用迭代
方式完成多次需求。但需要采用统一的ERD 模型，才能够将每次迭代的结果整合在一起。
ERD 模型是高度抽象的数据模型，描述了企业完整的数据。
而每次迭代则是完成E RD 模型的子集，通过DIS 和物理数
据模型实现。


业务建模，生成业务模型，主要解决业务层面的分解和程序化。
领域建模，生成领域模型，主要是对业务模型进行抽象处理， 生
成领域概念模型。
逻辑建模，生成逻辑模型，主要是将领域模型的概念实体以及实体之间的关系进行数据库层次的逻辑化。
物理建模，生成物理模型，主要解决逻辑模型针对不同关系数据库的物理化以及性能等一些具体的技术问题

OneData 实施过程
首先，在建设大数据数据仓库时，要进行充分的业务调研和需求分析。
其次，进行数据总体架构设计，主要是根据数据域对数据进行划分；
按照维度建模理论，构建总线矩阵、抽象出业务过程和维度。
再次，对报表需求进行抽象整理出相关指标体系，使用One Data 工具完成指标规范定义和模型设计。
最后，就是代码研发和运维。

2. 实施工作流

·业务调研
整个阿里集团涉及的业务涵盖电商、数字娱乐、导航（高德）、移
动互联网服务等领域。各个领域又涵盖多个业务线，如电商领域就涵盖
了C 类（淘宝、天猫、天猫国际）与B 类（阿里巴巴中文站、国际站、
速卖通）业务。数据仓库是要涵盖所有业务领域，还是各个业务领域独
自建设，业务领域内的业务线也同样面临着这个问题。所以要构建大数
据数据仓库，就需要了解各个业务领域、业务线的业务有什么共同点和
不同点，以及各个业务线可以细分为哪几个业务模块，每个业务模块具
体的业务流程又是怎样的。业务调研是否充分，将会直接决定数据仓库
建设是否成功。

在阿里巴巴， 一般各个业务领域独自建设数据仓库，业务领域内的
业务线由于业务相似、业务相关性较大，进行统一集中建设。

如表9.3 所示是粗粒度的C 类电商业务调研
，不难发现几个功能模块／业务线除了淘宝无供应链管理外，其他几乎一样


·需求调研
了解了业务系统的业务后并不代表就可以进行实施了，此刻要做的就是收集数据使用
者的需求，可以去找分析师、业务运营人员了解他们有什么数据诉求，
此时更多的就
是报表需求。

需求调研的途径有两种：

一是根据与分析师、业务运营人员的沟通（邮件、IM ）获知需求：

二是对报表系统中现有的报表进行研究分析。

通过需求调研分析后，就清楚数据要做成什么样的。
很多时候，都是由具体的数据需求驱动数据仓库团队去了解业务系统的业务数据，这两者
并没有严格的先后顺序。

举例： 分析师需要了解大淘宝（淘宝、天猫、天猫国际） 一级类目
的成交金额。当获知这个需求后，我们要分析根据什么（维度）汇总，
以及汇总什么（度量），这里类目是维度，金额是度量：明细数据和汇
总数据应该怎样设计？这是一个公用的报表吗？是需要沉淀到汇总表
里面，还是在报表工具中进行汇总？

商品管理..J ..J ..J
~ι贝口供t自l 立坦田..J ..J ..J
交易流程管理..J ..J ..J
用户行为跟踪..J ..J ..J
好中差评、DSR i平分..J ..J ..J
物流、库存管理..J ..J ..J
供应链管理NA ..J ..J
客户投诉与举
----------------------------------------




